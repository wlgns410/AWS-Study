# Amazon RDS & Aurora

<br>

![스크린샷 2023-03-31 오후 5 49 42](https://user-images.githubusercontent.com/81137234/229073466-3af040f4-c05e-470d-8820-86b816088103.png)

<br>

RDS는 두가지 생성방법이 있는데  
모든 옵션을 이용하는 표준생성 모드와 몇개를 생략하고 만드는 손쉬운 생성이 있다.

<br>

![스크린샷 2023-03-31 오후 5 53 10](https://user-images.githubusercontent.com/81137234/229074106-a1850637-593a-45cf-99ec-734440ab2ec7.png)

<br>

사용 사례에 맞게 지정할 수 있는 템플릿이 존재한다.  

![스크린샷 2023-03-31 오후 5 56 55](https://user-images.githubusercontent.com/81137234/229075023-c8d10ca5-6b96-417c-8bd6-f7f9104c926c.png)
![스크린샷 2023-03-31 오후 5 57 02](https://user-images.githubusercontent.com/81137234/229075035-cff6a440-c6b3-4e6b-ae45-5e74591cf265.png)

<br>

또한 특정 구성 매개변수가 지정되어 있다.  
템플릿에 따라 설정할 수 있는게 달라진다.

<br>

![스크린샷 2023-03-31 오후 5 59 17](https://user-images.githubusercontent.com/81137234/229075584-8eb188c9-d193-44c4-b26b-ff2cfd13ecec.png)

<br>

프로덕션 모드에서는 이전 세대 클래스 포함을 활성화 시켜야 t2.micro를 선택할 수 있다.  
프리티어 모드에서는 기본적으로 micro만 선택할 수 있으므로 활성화를 시키지 않아도 선택할 수 있다.

<br>

![스크린샷 2023-03-31 오후 6 00 40](https://user-images.githubusercontent.com/81137234/229075892-c21fc283-b1a1-43bc-b7b9-fcacb3905a27.png)

<br>

프리티어를 사용하려면 범용 크기인 gp2를 선택해야한다.  
gp2는 20GiB를 지원해주니 양호한 선택이 될 것이다.

<br>

![스크린샷 2023-03-31 오후 6 02 11](https://user-images.githubusercontent.com/81137234/229076233-b6d1b913-373a-4ff9-9d96-513b9338dd86.png)

<br>

스토리지 자동 조정을 활성화하면 스토리지 사용량이 20GiB에 가까워지면 AWS 내에서 다른 작업 없이 자동으로 스케일링이 진행된다.  
즉, 워크로드가 증가하면 자동으로 스케일링이 수행된다.

<br>

![스크린샷 2023-03-31 오후 6 05 02](https://user-images.githubusercontent.com/81137234/229076838-b3ae8cfb-8d37-4ad9-b0e3-9456defde09a.png)

![스크린샷 2023-03-31 오후 6 08 07](https://user-images.githubusercontent.com/81137234/229077502-cd36236f-eca7-45b5-9309-15b38c19da18.png)

<br>

위와 아래의 구성이 다른것을 볼 수 있다.  
위는 일반적인 RDS를 생성할 때 구성할 수 있는 것이고  
아래는 Aurora를 생성할 때 구성할 수 있는 것이다.  
아래 구성에 대해서 이야기를 해 보겠다.

Aurora에 대한 스탠바이 인스턴스를 가지게 되고 데이터 중복에 대하여 스탠바이 인스턴스가 제공될 것이며, I/O 동결 시 백업으로 이용되거나 백업 도중 지연 시간의 급증을 최소화할 수 있다.  
애플리케이션에 이용되는 것이 아니라 메인 인스턴스에 문제가 생기거나 리부팅이 필요할 때를 대비해서 존재한다. 

<br>

![스크린샷 2023-03-31 오후 6 10 50](https://user-images.githubusercontent.com/81137234/229078170-ba699002-96a8-48e2-b954-561c76c02490.png)

<br>

public access를 예로 선택해야 웹상에서 테스트해 볼 수 있다.  
내부적으로 사용할 것이라면 VPC를 이용해서 ip를 접속하기 때문에 아니오를 선택한다.

<br>

![스크린샷 2023-03-31 오후 6 12 11](https://user-images.githubusercontent.com/81137234/229078493-5f9c78b3-0348-4fbb-8342-4189a50e7203.png)

<br>

옵션은 3가지가 있다.  
첫번째는 단순하게 비밀번호를 입력해서 인증을 하는 것이다.  
두번째인 IAM을 통해서 RDS에 로그인하는 것으로 보안을 강화시킬 수 있다.  

<br>

![스크린샷 2023-03-31 오후 6 14 37](https://user-images.githubusercontent.com/81137234/229079064-e6806166-ee30-478b-9909-c8a7e3e15462.png)

<br>

데이터 베이스 이름을 붙임으로서 RDS나 Aurora가 생성됐을 때 DB 생성을 추가해야하는 번거로움을 없앨 수 있다.  
또한 백업 보존 기간을 지정할 수 있고  
마지막으로 RDS에 문제가 생겼을 때 다시 RDS를 띄울 수 있는 스냅샷 기능도 있다.

<br>

DB를 생성하면 해당 포트를 인바운드 규칙에서 확인 할 수 있다.  
해당 TCP 프로토콜의 포트는 아래와 같다.  
이 포트들을 열어줘야 한다.

```
MYSQL 3306
POSTGRESQL 5432
MSSQL 1433
ORACLE 1521
```

<br>

![스크린샷 2023-03-31 오후 6 21 43](https://user-images.githubusercontent.com/81137234/229080722-6875ff80-ac23-4f09-bc6f-92c11ba3df08.png)

<br>

DB 복제본을 생성해보자.  
읽기 추가를 하면 해당 데이터베이스 설정으로 똑같은 읽기 리더 인스턴스를 또 생성한다.  
이건 Aurora에서 가능한 기능이다.  
리전간 읽기 복제본 생성은 해당 데이터베이스 설정으로 다른 리전에 생성가능한 설정이다.  
스냅샷 생성을 하면 데이터베이스가 스냅샷으로 저장되어서 원할 때 복구할 수 있다.  
자동적으로 스냅샷이 저장되는 설정을 하면 불의의사고가 발생하는 것을 방지할 수 있다.  

추가기능인 블루/그린 배포, S3에 내보내기가 있다.  
RDS도 특정한 DB에 몇퍼센트만 트래픽을 보내겠다는 Canary가 가능하다는 점을 알아야한다.  


<br>

살펴보면 알 수 있는데, RDS와 Aurora가 가능한 기능이 정해져있어서 이를 구별해서 사용해야한다는 점을 알아야한다.

<br>

![스크린샷 2023-03-31 오후 6 29 11](https://user-images.githubusercontent.com/81137234/229083267-fe72727b-1143-4778-b8cf-e02a78259f52.png)

<br>

마지막으로 RDS와는 다르게 Aurora는 삭제 시  
삭제 방지 활성화를 해제한 다음에  
라이터 인스턴스 삭제 -> 리더 인스턴스 삭제 -> 리전 인스턴스 삭제  
순서대로 삭제해야한다.  

<br>

![스크린샷 2023-03-31 오후 6 32 01](https://user-images.githubusercontent.com/81137234/229083375-9fb899fe-a8d6-4cf0-8451-b946da8bef29.png)

<br>

만약 삭제 방지 활성화를 해제하지 않는다면 리더 인스턴스가 삭제되지 않으며  
마지막에 DB 삭제가 아닌 반대로 삭제를 한다면 리전 인스턴스가 삭제가 안된다.  

<br>

![스크린샷 2023-03-31 오후 6 40 13](https://user-images.githubusercontent.com/81137234/229085249-fd0ee591-da7f-4111-bd5a-db624be85408.png)

리더 인스턴스가 삭제된다면 마지막 순서로 리전 클러스터가 삭제된다.

<br>